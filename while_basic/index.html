<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C++ While 迴圈視覺化教學</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .highlight-line {
            background-color: rgba(234, 179, 8, 0.2);
            border-left: 4px solid #eab308;
            color: #fef08a;
        }
        .code-line {
            border-left: 4px solid transparent;
            transition: all 0.2s;
        }
        .console-text {
            font-family: 'Consolas', 'Monaco', monospace;
            animation: typeIn 0.3s ease-out;
        }
        @keyframes typeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .variable-change {
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen p-4 md:p-8 font-sans">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <div>
                <h1 class="text-2xl font-bold text-indigo-700 flex items-center gap-2">
                    <i data-lucide="repeat" class="w-8 h-8"></i>
                    C++ While 迴圈視覺化
                </h1>
                <p class="text-slate-500 text-sm mt-1">觀察變數 i 如何控制迴圈的執行次數與輸出</p>
            </div>

            <!-- Controls -->
            <div class="flex flex-wrap items-center gap-2 bg-white p-2 rounded-xl shadow-sm border border-slate-200">
                <div class="flex items-center gap-2 px-3 border-r border-slate-200">
                    <div class="flex flex-col text-xs text-slate-500">
                        <label>條件 (N)</label>
                        <input type="number" id="input-limit" value="5" min="1" max="20" class="w-12 border rounded px-1 text-slate-800 font-bold">
                    </div>
                    <div class="flex flex-col text-xs text-slate-500">
                        <label>初始 (i)</label>
                        <input type="number" id="input-init" value="0" min="0" max="10" class="w-12 border rounded px-1 text-slate-800 font-bold">
                    </div>
                     <div class="flex flex-col text-xs text-slate-500">
                        <label>增量 (+)</label>
                        <input type="number" id="input-step" value="1" min="1" max="5" class="w-12 border rounded px-1 text-slate-800 font-bold">
                    </div>
                    <button id="btn-reset" class="bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1 rounded text-xs ml-2">重置參數</button>
                </div>
                
                <button id="btn-play" class="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white hover:bg-indigo-700 rounded-lg font-medium transition-colors">
                    <i data-lucide="play" class="w-4 h-4"></i> 自動執行
                </button>
                <button id="btn-next" class="flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-700 hover:bg-slate-200 rounded-lg font-medium">
                    <i data-lucide="step-forward" class="w-4 h-4"></i> 下一步
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- Left Panel: Visualization -->
            <div class="space-y-6">
                
                <!-- Status Box -->
                <div id="status-box" class="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded-r-lg min-h-[4.5rem] flex items-center shadow-sm">
                    <span id="status-text" class="text-indigo-900 font-medium">準備就緒，請點擊「下一步」開始。</span>
                </div>

                <!-- Memory & Logic Visualization -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 to-purple-500"></div>
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-8">CPU 與 記憶體狀態</h3>

                    <div class="flex justify-around items-start">
                        
                        <!-- Variable Box -->
                        <div class="flex flex-col items-center">
                            <span class="text-xs text-slate-500 mb-1 font-mono">int i</span>
                            <div id="var-box" class="w-24 h-24 bg-white border-2 border-slate-300 rounded-xl flex flex-col items-center justify-center shadow-sm transition-all duration-300">
                                <span id="var-value" class="text-4xl font-bold text-slate-700">-</span>
                            </div>
                            <span class="text-xs text-green-600 mt-2 font-bold opacity-0 transition-opacity" id="inc-badge">+1</span>
                        </div>

                        <!-- Condition Check Visual -->
                        <div class="flex flex-col items-center justify-center mt-2 relative w-32">
                            <div class="text-xs text-slate-500 mb-2">條件判斷</div>
                            <div class="h-16 flex items-center justify-center">
                                <span id="condition-expr" class="font-mono text-lg text-slate-400">i &lt; <span id="limit-display">5</span></span>
                            </div>
                            <!-- Result Badge (Absolute) -->
                            <div id="condition-result" class="absolute top-8 transform scale-0 transition-transform duration-300">
                                <!-- JS Injects result here -->
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Console Output -->
                <div class="bg-slate-900 rounded-xl shadow-lg overflow-hidden flex flex-col h-64 border border-slate-700">
                    <div class="bg-slate-800 px-4 py-2 flex items-center gap-2 border-b border-slate-700">
                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                        <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                        <span class="text-xs text-slate-400 ml-2 font-mono">Terminal (Output)</span>
                    </div>
                    <div id="console-output" class="p-4 font-mono text-green-400 text-sm overflow-y-auto flex-1 space-y-1">
                        <!-- Output logs go here -->
                        <span class="text-slate-500 opacity-50 select-none">&gt; 等待程式執行...</span>
                    </div>
                </div>

            </div>

            <!-- Right Panel: Code -->
            <div class="relative">
                <div class="sticky top-6">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="font-bold text-slate-700">source.cpp</h3>
                    </div>
                    
                    <div class="bg-slate-900 text-slate-300 p-6 rounded-xl font-mono text-sm shadow-xl leading-relaxed relative overflow-hidden">
                        <!-- Line Numbers -->
                        <div class="absolute left-0 top-0 bottom-0 w-12 bg-slate-800/50 border-r border-slate-700 flex flex-col items-center pt-6 text-slate-600 select-none">
                            <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                        </div>

                        <!-- Code Content -->
                        <div class="pl-10 space-y-1" id="code-container">
                            <!-- JS will generate lines -->
                        </div>
                    </div>

                    <!-- Flow Explanation -->
                    <div class="mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-sm text-yellow-800">
                        <h4 class="font-bold mb-1 flex items-center gap-2">
                            <i data-lucide="info" class="w-4 h-4"></i> 邏輯說明
                        </h4>
                        <p id="logic-explanation">
                            While 迴圈會先檢查條件。只要條件為 <span class="font-mono font-bold">True</span>，就會執行大括號內的程式碼。一旦條件變成 <span class="font-mono font-bold">False</span>，迴圈就會立刻終止。
                        </p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // State
        const state = {
            limit: 5,
            init: 0,
            step: 1,
            i: null,
            line: 0, // 0: Start, 1: Init, 2: Check, 3: Print, 4: Inc, 5: EndLoop
            isPlaying: false,
            timer: null,
            finished: false,
            logs: []
        };

        // DOM Elements
        const els = {
            codeContainer: document.getElementById('code-container'),
            inputLimit: document.getElementById('input-limit'),
            inputInit: document.getElementById('input-init'),
            inputStep: document.getElementById('input-step'),
            btnReset: document.getElementById('btn-reset'),
            btnNext: document.getElementById('btn-next'),
            btnPlay: document.getElementById('btn-play'),
            statusBox: document.getElementById('status-box'),
            statusText: document.getElementById('status-text'),
            varBox: document.getElementById('var-box'),
            varValue: document.getElementById('var-value'),
            incBadge: document.getElementById('inc-badge'),
            conditionExpr: document.getElementById('condition-expr'),
            conditionResult: document.getElementById('condition-result'),
            limitDisplay: document.getElementById('limit-display'),
            consoleOutput: document.getElementById('console-output'),
            logicExplanation: document.getElementById('logic-explanation')
        };

        // Code Template
        function getCodeLines() {
            return [
                `int i = ${state.init};`,
                `while (i < ${state.limit}) {`,
                `    cout << i << endl;`,
                `    i = i + ${state.step};`,
                `}`
            ];
        }

        // Initialize UI
        function init() {
            renderCode();
            lucide.createIcons();
            updateValuesFromInputs();
        }

        function updateValuesFromInputs() {
            state.limit = parseInt(els.inputLimit.value) || 5;
            state.init = parseInt(els.inputInit.value) || 0;
            state.step = parseInt(els.inputStep.value) || 1;
            renderCode(); // Re-render code to show new numbers
            reset();
        }

        function renderCode() {
            const lines = getCodeLines();
            els.codeContainer.innerHTML = lines.map((text, idx) => `
                <div id="line-${idx + 1}" class="code-line px-2 py-1 rounded flex">
                    <span class="whitespace-pre">${text}</span>
                </div>
            `).join('');
            els.limitDisplay.innerText = state.limit;
            els.conditionExpr.innerHTML = `i &lt; ${state.limit}`;
        }

        function reset() {
            stopPlay();
            state.line = 0;
            state.i = null;
            state.finished = false;
            state.logs = [];
            
            // Reset Visuals
            els.varValue.innerText = "-";
            els.varBox.className = "w-24 h-24 bg-white border-2 border-slate-300 rounded-xl flex flex-col items-center justify-center shadow-sm transition-all duration-300";
            els.consoleOutput.innerHTML = `<span class="text-slate-500 opacity-50 select-none">&gt; 等待程式執行...</span>`;
            els.conditionResult.classList.add('scale-0');
            els.incBadge.style.opacity = '0';
            updateStatus("準備就緒，點擊下一步開始");
            highlightLine(0);
        }

        function highlightLine(lineNum) {
            document.querySelectorAll('.code-line').forEach(el => el.className = 'code-line px-2 py-1 rounded flex'); // reset
            if (lineNum > 0) {
                const el = document.getElementById(`line-${lineNum}`);
                if (el) el.className = 'code-line px-2 py-1 rounded flex highlight-line';
            }
        }

        function updateStatus(text, type = 'normal') {
            els.statusText.innerText = text;
            els.statusBox.className = "p-4 rounded-r-lg min-h-[4.5rem] flex items-center shadow-sm border-l-4 transition-colors duration-300";
            
            if (type === 'success') {
                els.statusBox.classList.add('bg-green-50', 'border-green-500', 'text-green-900');
            } else if (type === 'fail') {
                els.statusBox.classList.add('bg-red-50', 'border-red-500', 'text-red-900');
            } else if (type === 'wait') {
                els.statusBox.classList.add('bg-slate-100', 'border-slate-400', 'text-slate-600');
            } else {
                els.statusBox.classList.add('bg-indigo-50', 'border-indigo-500', 'text-indigo-900');
            }
        }

        function playLog(text) {
            if (state.logs.length === 0) els.consoleOutput.innerHTML = ''; // Clear placeholder
            const line = document.createElement('div');
            line.className = 'console-text';
            line.innerText = text;
            els.consoleOutput.appendChild(line);
            els.consoleOutput.scrollTop = els.consoleOutput.scrollHeight;
            state.logs.push(text);
        }

        function nextStep() {
            if (state.finished) return;

            // Clear transient animations
            els.conditionResult.classList.add('scale-0');
            els.incBadge.style.opacity = '0';
            els.varBox.classList.remove('variable-change', 'border-indigo-500', 'border-green-500');

            // Logic Machine
            switch (state.line) {
                case 0: // Start -> Init
                    state.line = 1;
                    state.i = state.init;
                    els.varValue.innerText = state.i;
                    els.varBox.classList.add('variable-change', 'border-indigo-500');
                    updateStatus(`初始化變數 i = ${state.i}`);
                    break;

                case 1: // Init -> Check
                case 5: // Loop End -> Check
                    state.line = 2;
                    const isTrue = state.i < state.limit;
                    
                    // Show result bubble
                    els.conditionResult.innerHTML = isTrue 
                        ? `<span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-bold border border-green-300 shadow-sm flex items-center gap-1"><i data-lucide="check" class="w-4 h-4"></i> True</span>`
                        : `<span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-sm font-bold border border-red-300 shadow-sm flex items-center gap-1"><i data-lucide="x" class="w-4 h-4"></i> False</span>`;
                    lucide.createIcons();
                    
                    requestAnimationFrame(() => els.conditionResult.classList.remove('scale-0'));

                    if (isTrue) {
                        updateStatus(`檢查：${state.i} < ${state.limit} 成立 (True)，進入迴圈`, 'success');
                    } else {
                        updateStatus(`檢查：${state.i} < ${state.limit} 不成立 (False)，跳出迴圈`, 'fail');
                        state.finished = true;
                        stopPlay();
                    }
                    break;

                case 2: // Check -> Print (if true) or End
                    if (state.finished) {
                         // Actually nothing to highlight as we left the block, but let's clear highlight
                         highlightLine(0);
                         updateStatus("程式執行結束。", "wait");
                         return;
                    }
                    state.line = 3;
                    playLog(state.i);
                    updateStatus(`執行 cout：輸出 ${state.i}`);
                    break;

                case 3: // Print -> Inc
                    state.line = 4;
                    const oldI = state.i;
                    state.i = state.i + state.step;
                    
                    els.varValue.innerText = state.i;
                    els.varBox.classList.add('variable-change', 'border-green-500');
                    els.incBadge.innerText = `+${state.step}`;
                    els.incBadge.style.opacity = '1';
                    
                    updateStatus(`變數更新：i 變成 ${state.i} (原 ${oldI} + ${state.step})`);
                    break;

                case 4: // Inc -> End Loop brace
                    state.line = 5;
                    updateStatus("迴圈區塊結束，準備回到頂端重新檢查條件");
                    break;
            }

            highlightLine(state.line);
        }

        // Playback Controls
        function togglePlay() {
            if (state.isPlaying) {
                stopPlay();
            } else {
                if (state.finished) reset();
                state.isPlaying = true;
                els.btnPlay.innerHTML = `<i data-lucide="pause" class="w-4 h-4"></i> 暫停`;
                els.btnPlay.classList.replace('bg-indigo-600', 'bg-red-500');
                els.btnPlay.classList.replace('hover:bg-indigo-700', 'hover:bg-red-600');
                lucide.createIcons();
                
                // Disable inputs
                setInputDisabled(true);

                state.timer = setInterval(() => {
                    if (state.finished) {
                        stopPlay();
                    } else {
                        nextStep();
                    }
                }, 1200);
            }
        }

        function stopPlay() {
            state.isPlaying = false;
            clearInterval(state.timer);
            els.btnPlay.innerHTML = `<i data-lucide="play" class="w-4 h-4"></i> 自動執行`;
            els.btnPlay.classList.replace('bg-red-500', 'bg-indigo-600');
            els.btnPlay.classList.replace('hover:bg-red-600', 'hover:bg-indigo-700');
            lucide.createIcons();
            setInputDisabled(false);
        }

        function setInputDisabled(disabled) {
            els.inputLimit.disabled = disabled;
            els.inputInit.disabled = disabled;
            els.inputStep.disabled = disabled;
            els.btnReset.disabled = disabled;
        }

        // Event Listeners
        els.btnNext.addEventListener('click', () => {
            if(state.finished) return;
            stopPlay();
            setInputDisabled(true); // Once started, lock inputs
            nextStep();
        });
        els.btnPlay.addEventListener('click', togglePlay);
        els.btnReset.addEventListener('click', updateValuesFromInputs);
        
        // Input Listeners (Auto update only if not playing)
        [els.inputLimit, els.inputInit, els.inputStep].forEach(input => {
            input.addEventListener('change', () => {
                if (!state.isPlaying && state.line === 0) updateValuesFromInputs();
            });
        });

        // Start
        init();

    </script>
</body>
</html>
